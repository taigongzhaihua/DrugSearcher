<Window x:Class="DrugSearcher.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:viewModels="clr-namespace:DrugSearcher.ViewModels"
        xmlns:local="clr-namespace:DrugSearcher.Common.Converters"
        mc:Ignorable="d"
        Title="{Binding Title}"
        Height="780"
        Width="1100"
        Style="{StaticResource BaseWindowStyle}"
        d:DataContext="{d:DesignInstance viewModels:MainWindowViewModel}">

    <Window.Resources>
        <!-- ContextMenu 样式 -->
        <Style x:Key="FunctionContextMenuStyle" TargetType="ContextMenu">
            <Setter Property="Background" Value="{DynamicResource SurfaceBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="8"/>
            <Setter Property="Effect" Value="{StaticResource DropShadowEffect}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ContextMenu">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="8"
                                Padding="{TemplateBinding Padding}"
                                Effect="{TemplateBinding Effect}">
                            <StackPanel IsItemsHost="True"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- MenuItem 样式 -->
        <Style x:Key="FunctionMenuItemStyle" TargetType="MenuItem">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{DynamicResource PrimaryTextBrush}"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="Margin" Value="2"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="MinWidth" Value="180"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="MenuItem">
                        <Border x:Name="Border"
                                Background="{TemplateBinding Background}"
                                CornerRadius="4"
                                Padding="{TemplateBinding Padding}">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- 图标 -->
                                <TextBlock Grid.Column="0"
                                           Text="{TemplateBinding Tag}"
                                           FontFamily="{DynamicResource IconFont}"
                                           FontSize="16"
                                           Margin="0,0,12,0"
                                           VerticalAlignment="Center"
                                           Foreground="{DynamicResource PrimaryBrush}"/>

                                <!-- 文本 -->
                                <TextBlock Grid.Column="1"
                                           Text="{TemplateBinding Header}"
                                           VerticalAlignment="Center"/>

                                <!-- 子菜单箭头 -->
                                <TextBlock Grid.Column="2"
                                           Text="&#xe619;"
                                           FontFamily="{DynamicResource IconFont}"
                                           FontSize="12"
                                           VerticalAlignment="Center"
                                           Visibility="{Binding HasItems, RelativeSource={RelativeSource TemplatedParent}, Converter={x:Static local:Converters.BooleanToVisibilityConverter}}"/>

                                <!-- 子菜单弹出框 -->
                                <Popup x:Name="PART_Popup"
                                       IsOpen="{Binding IsSubmenuOpen, RelativeSource={RelativeSource TemplatedParent}}"
                                       Placement="Right"
                                       AllowsTransparency="True"
                                       PopupAnimation="Slide">
                                    <Border Background="{DynamicResource SurfaceBrush}"
                                            BorderBrush="{DynamicResource BorderBrush}"
                                            BorderThickness="1"
                                            CornerRadius="8"
                                            Padding="8"
                                            Effect="{StaticResource DropShadowEffect}">
                                        <StackPanel IsItemsHost="True"/>
                                    </Border>
                                </Popup>
                            </Grid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsHighlighted" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="{DynamicResource HoverBrush}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="{DynamicResource PressedBrush}"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Foreground" Value="{DynamicResource DisabledTextBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- 分隔线样式 -->
        <Style x:Key="MenuSeparatorStyle" TargetType="Separator">
            <Setter Property="Background" Value="{DynamicResource BorderBrush}"/>
            <Setter Property="Height" Value="1"/>
            <Setter Property="Margin" Value="8,4"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Separator">
                        <Border Background="{TemplateBinding Background}" 
                                Height="{TemplateBinding Height}"/>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- 主题颜色选择模板 -->
        <DataTemplate x:Key="ThemeColorTemplate">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- 标题 -->
                <TextBlock Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="4"
                           Text="选择主题颜色"
                           FontSize="14"
                           FontWeight="Medium"
                           Foreground="{DynamicResource PrimaryTextBrush}"
                           HorizontalAlignment="Center"
                           Margin="0,0,0,8"/>

                <!-- 明暗模式切换 -->
                <Button Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="4"
                        Content="{Binding ThemeButtonText, Source={x:Static Application.Current}}"
                        Command="{Binding SwitchThemeCommand, Source={x:Static Application.Current}}"
                        Style="{StaticResource TransparentThemeButtonStyle}"
                        HorizontalAlignment="Center"
                        Margin="0,0,0,8"/>

                <!-- 颜色选择网格 -->
                <UniformGrid Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="4"
                             Columns="4" Rows="2"
                             Margin="0,0,0,0">

                    <!-- 蓝色主题 -->
                    <RadioButton Style="{DynamicResource ColorPickerRadioButtonStyle}"
                                 GroupName="ThemeColors"
                                 ToolTip="蓝色主题"
                                 Tag="Blue"
                                 IsChecked="{Binding ColorSelectionStates[Blue], Source={x:Static Application.Current}}"
                                 Command="{Binding SwitchThemeColorCommand, Source={x:Static Application.Current}}"
                                 CommandParameter="Blue"
                                 Margin="2">
                        <RadioButton.Content>
                            <Ellipse Width="24" Height="24" Fill="#2196F3"/>
                        </RadioButton.Content>
                    </RadioButton>

                    <!-- 其他颜色按钮... -->
                    <RadioButton Style="{DynamicResource ColorPickerRadioButtonStyle}"
                                 GroupName="ThemeColors"
                                 ToolTip="粉色主题"
                                 Tag="Pink"
                                 IsChecked="{Binding ColorSelectionStates[Pink], Source={x:Static Application.Current}}"
                                 Command="{Binding SwitchThemeColorCommand, Source={x:Static Application.Current}}"
                                 CommandParameter="Pink"
                                 Margin="2">
                        <RadioButton.Content>
                            <Ellipse Width="24" Height="24" Fill="#E91E63"/>
                        </RadioButton.Content>
                    </RadioButton>

                    <RadioButton Style="{DynamicResource ColorPickerRadioButtonStyle}"
                                 GroupName="ThemeColors"
                                 ToolTip="青色主题"
                                 Tag="Cyan"
                                 IsChecked="{Binding ColorSelectionStates[Cyan], Source={x:Static Application.Current}}"
                                 Command="{Binding SwitchThemeColorCommand, Source={x:Static Application.Current}}"
                                 CommandParameter="Cyan"
                                 Margin="2">
                        <RadioButton.Content>
                            <Ellipse Width="24" Height="24" Fill="#00BCD4"/>
                        </RadioButton.Content>
                    </RadioButton>

                    <RadioButton Style="{DynamicResource ColorPickerRadioButtonStyle}"
                                 GroupName="ThemeColors"
                                 ToolTip="绿色主题"
                                 Tag="Green"
                                 IsChecked="{Binding ColorSelectionStates[Green], Source={x:Static Application.Current}}"
                                 Command="{Binding SwitchThemeColorCommand, Source={x:Static Application.Current}}"
                                 CommandParameter="Green"
                                 Margin="2">
                        <RadioButton.Content>
                            <Ellipse Width="24" Height="24" Fill="#4CAF50"/>
                        </RadioButton.Content>
                    </RadioButton>

                    <RadioButton Style="{DynamicResource ColorPickerRadioButtonStyle}"
                                 GroupName="ThemeColors"
                                 ToolTip="紫色主题"
                                 Tag="Purple"
                                 IsChecked="{Binding ColorSelectionStates[Purple], Source={x:Static Application.Current}}"
                                 Command="{Binding SwitchThemeColorCommand, Source={x:Static Application.Current}}"
                                 CommandParameter="Purple"
                                 Margin="2">
                        <RadioButton.Content>
                            <Ellipse Width="24" Height="24" Fill="#9C27B0"/>
                        </RadioButton.Content>
                    </RadioButton>

                    <RadioButton Style="{DynamicResource ColorPickerRadioButtonStyle}"
                                 GroupName="ThemeColors"
                                 ToolTip="橙色主题"
                                 Tag="Orange"
                                 IsChecked="{Binding ColorSelectionStates[Orange], Source={x:Static Application.Current}}"
                                 Command="{Binding SwitchThemeColorCommand, Source={x:Static Application.Current}}"
                                 CommandParameter="Orange"
                                 Margin="2">
                        <RadioButton.Content>
                            <Ellipse Width="24" Height="24" Fill="#FF9800"/>
                        </RadioButton.Content>
                    </RadioButton>

                    <RadioButton Style="{DynamicResource ColorPickerRadioButtonStyle}"
                                 GroupName="ThemeColors"
                                 ToolTip="红色主题"
                                 Tag="Red"
                                 IsChecked="{Binding ColorSelectionStates[Red], Source={x:Static Application.Current}}"
                                 Command="{Binding SwitchThemeColorCommand, Source={x:Static Application.Current}}"
                                 CommandParameter="Red"
                                 Margin="2">
                        <RadioButton.Content>
                            <Ellipse Width="24" Height="24" Fill="#F44336"/>
                        </RadioButton.Content>
                    </RadioButton>

                    <RadioButton Style="{DynamicResource ColorPickerRadioButtonStyle}"
                                 GroupName="ThemeColors"
                                 ToolTip="靛蓝色主题"
                                 Tag="Indigo"
                                 IsChecked="{Binding ColorSelectionStates[Indigo], Source={x:Static Application.Current}}"
                                 Command="{Binding SwitchThemeColorCommand, Source={x:Static Application.Current}}"
                                 CommandParameter="Indigo"
                                 Margin="2">
                        <RadioButton.Content>
                            <Ellipse Width="24" Height="24" Fill="#3F51B5"/>
                        </RadioButton.Content>
                    </RadioButton>
                </UniformGrid>
            </Grid>
        </DataTemplate>
    </Window.Resources>

    <Grid>
        <!-- 窗口顶部工具栏 -->
        <StackPanel HorizontalAlignment="Right"
                    VerticalAlignment="Top"
                    Orientation="Horizontal"
                    Panel.ZIndex="10">

            <!-- 功能按钮组 -->
            <StackPanel Orientation="Horizontal" Margin="0,10,10,0">

                <!-- 主页按钮 -->
                <Button x:Name="HomeButton"
                        Content="{Binding HomeButtonText}"
                        Style="{DynamicResource TransparentThemeButtonStyle}"
                        Click="HomeButton_OnClick"
                        Margin="0,0,5,0"
                        ToolTip="主页"
                        WindowChrome.IsHitTestVisibleInChrome="True" />

                <!-- 导航按钮组 -->
                <StackPanel Orientation="Horizontal">
                    <!-- 后退按钮 -->
                    <Button x:Name="BackButton"
                            Content="&#xe617;"
                            Style="{DynamicResource TransparentThemeButtonStyle}"
                            Click="BackButton_OnClick"
                            Margin="0,0,5,0"
                            ToolTip="后退"
                            IsEnabled="{Binding CanGoBack, ElementName=MainFrame}"
                            WindowChrome.IsHitTestVisibleInChrome="True" />

                    <!-- 前进按钮 -->
                    <Button x:Name="ForwardButton"
                            Content="&#xe618;"
                            Style="{DynamicResource TransparentThemeButtonStyle}"
                            Click="ForwardButton_OnClick"
                            Margin="0,0,5,0"
                            ToolTip="前进"
                            IsEnabled="{Binding CanGoForward, ElementName=MainFrame}"
                            WindowChrome.IsHitTestVisibleInChrome="True" />
                </StackPanel>

                <!-- 功能菜单按钮 -->
                <Button x:Name="MenuButton"
                        Content="&#xe616;"
                        Style="{DynamicResource TransparentThemeButtonStyle}"
                        Click="MenuButton_OnClick"
                        Margin="0,0,10,0"
                        ToolTip="功能菜单"
                        WindowChrome.IsHitTestVisibleInChrome="True">

                    <!-- 功能菜单 -->
                    <Button.ContextMenu>
                        <ContextMenu x:Name="FunctionContextMenu" 
                                     Style="{StaticResource FunctionContextMenuStyle}">

                            <!-- 菜单标题 -->
                            <MenuItem Header="功能菜单" 
                                      IsEnabled="False"
                                      FontWeight="Bold"
                                      Foreground="{DynamicResource PrimaryBrush}"/>

                            <Separator Style="{StaticResource MenuSeparatorStyle}"/>

                            <!-- 数据管理 -->
                            <MenuItem Header="本地数据管理"
                                      Tag="&#xe623;"
                                      Style="{StaticResource FunctionMenuItemStyle}"
                                      Click="DataManagementMenuItem_Click"
                                      ToolTip="本地数据管理"/>

                            <!-- 设置 -->
                            <MenuItem x:Name="SettingsMenuItem"
                                      Header="设置"
                                      Tag="{Binding SettingsButtonText}"
                                      Style="{StaticResource FunctionMenuItemStyle}"
                                      Click="SettingsMenuItem_Click"
                                      ToolTip="应用设置"/>

                            <!-- 主题设置 -->
                            <MenuItem Header="主题设置"
                                      Tag="&#xe614;"
                                      Style="{StaticResource FunctionMenuItemStyle}"
                                      ToolTip="主题和外观设置">

                                <!-- 主题子菜单 -->
                                <MenuItem.Items>
                                    <!-- 明暗模式切换 -->
                                    <MenuItem Header="切换明暗模式"
                                              Tag="{Binding ThemeButtonText}"
                                              Style="{StaticResource FunctionMenuItemStyle}"
                                              Command="{Binding SwitchThemeCommand}"
                                              ToolTip="{Binding ThemeTooltip}"/>

                                    <Separator Style="{StaticResource MenuSeparatorStyle}"/>

                                    <!-- 颜色主题选择 -->
                                    <MenuItem Header="蓝色主题"
                                              Tag="●"
                                              Style="{StaticResource FunctionMenuItemStyle}"
                                              Command="{Binding SwitchThemeColorCommand}"
                                              CommandParameter="Blue"
                                              IsCheckable="True"
                                              IsChecked="{Binding ColorSelectionStates[Blue]}"/>

                                    <MenuItem Header="粉色主题"
                                              Tag="●"
                                              Style="{StaticResource FunctionMenuItemStyle}"
                                              Command="{Binding SwitchThemeColorCommand}"
                                              CommandParameter="Pink"
                                              IsCheckable="True"
                                              IsChecked="{Binding ColorSelectionStates[Pink]}"/>

                                    <MenuItem Header="青色主题"
                                              Tag="●"
                                              Style="{StaticResource FunctionMenuItemStyle}"
                                              Command="{Binding SwitchThemeColorCommand}"
                                              CommandParameter="Cyan"
                                              IsCheckable="True"
                                              IsChecked="{Binding ColorSelectionStates[Cyan]}"/>

                                    <MenuItem Header="绿色主题"
                                              Tag="●"
                                              Style="{StaticResource FunctionMenuItemStyle}"
                                              Command="{Binding SwitchThemeColorCommand}"
                                              CommandParameter="Green"
                                              IsCheckable="True"
                                              IsChecked="{Binding ColorSelectionStates[Green]}"/>

                                    <MenuItem Header="紫色主题"
                                              Tag="●"
                                              Style="{StaticResource FunctionMenuItemStyle}"
                                              Command="{Binding SwitchThemeColorCommand}"
                                              CommandParameter="Purple"
                                              IsCheckable="True"
                                              IsChecked="{Binding ColorSelectionStates[Purple]}"/>

                                    <MenuItem Header="橙色主题"
                                              Tag="●"
                                              Style="{StaticResource FunctionMenuItemStyle}"
                                              Command="{Binding SwitchThemeColorCommand}"
                                              CommandParameter="Orange"
                                              IsCheckable="True"
                                              IsChecked="{Binding ColorSelectionStates[Orange]}"/>

                                    <MenuItem Header="红色主题"
                                              Tag="●"
                                              Style="{StaticResource FunctionMenuItemStyle}"
                                              Command="{Binding SwitchThemeColorCommand}"
                                              CommandParameter="Red"
                                              IsCheckable="True"
                                              IsChecked="{Binding ColorSelectionStates[Red]}"/>

                                    <MenuItem Header="靛蓝色主题"
                                              Tag="●"
                                              Style="{StaticResource FunctionMenuItemStyle}"
                                              Command="{Binding SwitchThemeColorCommand}"
                                              CommandParameter="Indigo"
                                              IsCheckable="True"
                                              IsChecked="{Binding ColorSelectionStates[Indigo]}"/>
                                </MenuItem.Items>
                            </MenuItem>

                            <Separator Style="{StaticResource MenuSeparatorStyle}"/>

                            <!-- 关于 -->
                            <MenuItem Header="关于"
                                      Tag="&#xe621;"
                                      Style="{StaticResource FunctionMenuItemStyle}"
                                      Click="AboutMenuItem_Click"
                                      ToolTip="关于应用程序"/>
                        </ContextMenu>
                    </Button.ContextMenu>
                </Button>
            </StackPanel>

            <!-- 窗口控制按钮组 -->
            <StackPanel Orientation="Horizontal" Margin="0,10,15,0">
                <!-- 最小化按钮 -->
                <Button x:Name="MinimizeButton"
                        Content="&#xe60e;"
                        Style="{DynamicResource TransparentThemeButtonStyle}"
                        Click="MinimizeButton_Click"
                        Margin="0,0,5,0"
                        ToolTip="最小化窗口"
                        WindowChrome.IsHitTestVisibleInChrome="True" />

                <!-- 最大化/还原按钮 -->
                <Button x:Name="MaximizeButton"
                        Content="&#xe60d;"
                        Style="{DynamicResource TransparentThemeButtonStyle}"
                        Click="MaximizeButton_OnClick"
                        Margin="0,0,5,0"
                        ToolTip="最大化窗口"
                        WindowChrome.IsHitTestVisibleInChrome="True" />

                <!-- 关闭按钮 -->
                <Button x:Name="CloseButton"
                        Content="&#xe60f;"
                        Style="{DynamicResource TransparentThemeButtonStyle}"
                        Click="CloseButton_Click"
                        Margin="0,0,0,0"
                        ToolTip="关闭窗口"
                        WindowChrome.IsHitTestVisibleInChrome="True" />
            </StackPanel>
        </StackPanel>

        <!-- 主要内容区域 -->
        <Grid Margin="0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <!-- 应用图标和标题栏 -->
            <StackPanel Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2"
                        Orientation="Horizontal"
                        Margin="15,10,0,10">

                <!-- 应用图标 -->
                <TextBlock x:Name="ApplicationIcon"
                           Text="&#xe622;"
                           FontFamily="{DynamicResource IconFont}"
                           FontSize="18"
                           Foreground="{DynamicResource PrimaryBrush}"
                           VerticalAlignment="Center"
                           Margin="0,0,10,0" />

                <!-- 应用标题 -->
                <TextBlock Text="{Binding Title}"
                           FontSize="16"
                           FontWeight="Medium"
                           Foreground="{DynamicResource PrimaryTextBrush}"
                           VerticalAlignment="Center" />
            </StackPanel>

            <!-- 页面导航框架 -->
            <Frame x:Name="MainFrame"
                   Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2"
                   Margin="5"
                   NavigationUIVisibility="Hidden"
                   Background="Transparent" />
        </Grid>
    </Grid>
</Window>